{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"$defs": {
		"indexValue": {
			"type": "integer",
			"minimum": 0
		},
		"positiveNumber": {
			"type": "number",
			"minimum": 0
		},
		"pixelCount": {
			"type": "integer",
			"exclusiveMinimum": 0
		},
		"offset": {
			"type": "object",
			"properties": {
				"x": { "type": "number" },
				"y": { "type": "number" },
				"z": { "type": "number" }
			},
			"required": ["x", "y", "z"]
		},
		"scaleValue": {
			"type": "number",
			"default": 1,
			"exclusiveMinimum": 0
		},
		"scale": {
			"description": "",
			"anyOf": [
				{ "$ref": "#/$defs/scaleValue" },
				{
					"type": "object",
					"properties": {
						"x": { "$ref": "#/$defs/scaleValue" },
						"y": { "$ref": "#/$defs/scaleValue" },
						"z": { "$ref": "#/$defs/scaleValue" }
					},
					"additionalProperties": false
				}
			]
		},
		"rotationValue": {
			"type": "number",
			"minimum": -1,
			"maximum": 1
		},
		"rotation": {
			"description": "Three-dimensional rotation",
			"type": "object",
			"properties": {
				"x": { "$ref": "#/$defs/rotationValue" },
				"y": { "$ref": "#/$defs/rotationValue" },
				"z": { "$ref": "#/$defs/rotationValue" },
				"w": { "$ref": "#/$defs/rotationValue" }
			},
			"required": ["x", "y", "z", "w"]
		},
		"transform": {
			"description": "",
			"type": "object",
			"properties": {
				"offset": { "$ref": "#/$defs/offset" },
				"scale": { "$ref": "#/$defs/scale" },
				"rotation": { "$ref": "#/$defs/rotation" }
			},
			"required": ["offset", "scale", "rotation"]
		},
		"boneData": {
			"description": "",
			"type": "object",
			"properties": {
				"id": { "type": "string" },
				"offset": { "$ref": "#/$defs/offset" },
				"childRotation": {
					"$ref": "#/$defs/rotation",
					"description": "Additional rotation to all child bones relative to self. Equivalent to transform frame rotation in Rosbag."
				},
				"children": {
					"type": "array",
					"items": { "$ref": "#/$defs/boneData" }
				}
			},
			"required": ["id", "offset"]
		}
	},
	"type": "object",
	"properties": {
		"render": {
			"type": "object",
			"properties": {
				"device": {
					"enum": ["CPU", "GPU"]
				},
				"samples": {
					"type": "integer",
					"minimum": 1
				}
			},
			"required": ["device", "samples"]
		},
		"scene": {
			"type": "object",
			"required": ["zeroCoordinate", "sun", "obstacleID"]
		},
		"bones": { 
			"type": "array",
			"items": { "$ref": "#/$defs/boneData" }
		},
		"interpolationMode": {
			"enum": [
				"last",
				"linear"
			]
		},
		"animation": {
			"type": "object",
			"properties": {
				"sourceMapping": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"file": {
								"type": "string"
							},
							"values": {
								"type": "array",
								"items": {
									"type": "object",
									"properties": {
										"jsonPath": {
											"type": "array",
											"items": {
												"type": "string"
											}
										},
										"assignedKey": {
											"type": "string"
										}
									},
									"required": ["jsonPath", "assignedKey"]
								}
							},
							"calculatedValues": {
								"type": "array",
								"items": {
									"type": "object",
									"properties": {
										"key": {
											"type": "string"
										},
										"expression": {
											"type": "string",
											"pattern": "^lambda data, index: "
										}
									},
									"required": ["key", "expression"]
								}
							}
						},
						"required": ["file", "values"]
					}
				},
				"boneMapping": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"valueKey": {
								"type": "string"
							},
							"animationTarget": {
								"type": "object",
								"properties": {
									"boneID": {
										"description": "Animated bone",
										"type": "string"
									},
									"dataPath": {
										"description": "Path to animated bone data",
										"enum": ["rotation_quaternion", "rotation_euler", "location"]
									},
									"dataIndex": {
										"description": "Array index of data (only required if dataPath references an array)",
										"$ref": "#/$defs/indexValue"
									}
								},
								"required": ["boneID", "dataPath"],
								"if": {
									"properties": {
										"dataPath": {
											"enum": ["rotation_quaternion", "rotation_euler", "location"]
										}
									}
								},
								"then": {
									"required": ["dataIndex"]
								}
							}
						},
						"required": ["valueKey", "animationTarget"]
					}
				}
			},
			"required": ["sourceMapping", "boneMapping"]
		},
		"animationMapping": {
			"type": "array",
			"items": {
				"type": "object",
				"properties": {
					"odomSource": {
						"description": "Path to animation data",
						"type": "array",
						"items": {
							"type": "string"
						}
					},
					"animTarget": {
						"type": "object",
						"properties": {
							"boneID": {
								"description": "Animated bone",
								"type": "string"
							},
							"dataPath": {
								"description": "Path to animated bone data",
								"enum": ["rotation_quaternion", "location"]
							},
							"dataIndex": {
								"description": "Array index of data (only required if dataPath references an array)",
								"$ref": "#/$defs/indexValue"
							}
						},
						"required": ["boneID", "dataPath"],
						"if": {
							"properties": {
								"dataPath": {
									"enum": ["rotation_quaternion", "location"]
								}
							}
						},
						"then": {
							"required": ["dataIndex"]
						}
					}
				},
				"required": ["odomSource", "animTarget"]
			}
		},
		"sensors": {
			"type": "array",
			"items": {
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"type": {
						"enum": ["camera", "lidar"]
					},
					"fov": {
						"type": "number",
						"exclusiveMinimum": 0,
						"exclusiveMaximum": 180
					},
					"resolution": {
						"type": "object",
						"properties": {
							"width": { "$ref": "#/$defs/pixelCount" },
							"height": { "$ref": "#/$defs/pixelCount" }
						}
					},
					"parentBone": {
						"description": "ID of the bone by which this sensors movement is controlled",
						"type": "string"
					}
				}
			}
		},
		"output": {
			"type": "object",
			"properties": {
				"exportPath": {
					"type": "string"
				},
				"generateAlphaMaps": {
					"type": "boolean"
				}
			},
			"required": ["exportPath", "generateAlphaMaps"]
		}
	},
	"required": ["scene", "bones", "sensors", "output"]
}