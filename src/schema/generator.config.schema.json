{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"$defs": {
		"indexValue": {
			"type": "integer",
			"minimum": 0
		},
		"offset": {
			"type": "object",
			"properties": {
				"x": { "type": "number" },
				"y": { "type": "number" },
				"z": { "type": "number" }
			},
			"required": ["x", "y", "z"]
		},
		"rotationValue": {
			"type": "number",
			"minimum": -1,
			"maximum": 1
		},
		"rotation": {
			"description": "Three-dimensional rotation",
			"type": "object",
			"properties": {
				"x": { "$ref": "#/$defs/rotationValue" },
				"y": { "$ref": "#/$defs/rotationValue" },
				"z": { "$ref": "#/$defs/rotationValue" },
				"w": { "$ref": "#/$defs/rotationValue" }
			},
			"required": ["x", "y", "z", "w"]
		},
		"boneData": {
			"description": "",
			"type": "object",
			"properties": {
				"id": { "type": "string" },
				"offset": { "$ref": "#/$defs/offset" },
				"childRotation": {
					"$ref": "#/$defs/rotation",
					"description": "Additional rotation to all child bones relative to self. Equivalent to transform frame rotation in Rosbag."
				},
				"children": {
					"type": "array",
					"items": { "$ref": "#/$defs/boneData" }
				}
			},
			"required": ["id", "offset"]
		}
	},
	"type": "object",
	"required": ["render", "scene", "bones", "animation", "sensors", "output"],
	"properties": {
		"render": {
			"description": "Render settings",
			"type": "object",
			"required": ["device", "samples"],
			"properties": {
				"device": {
					"description": "Render operation will be executed on this computing device",
					"enum": ["CPU", "GPU"]
				},
				"samples": {
					"description": "Number of calculated samples for lighting. Higher values greatly increase render time.",
					"type": "integer",
					"minimum": 1
				}
			}
		},
		"scene": {
			"description": "Scene settings",
			"type": "object",
			"required": ["obstacleID", "sun"],
			"properties": {
				"obstacleID": {
					"description": "Object name of the obstacle in the imported scene",
					"type": "string"
				},
				"sun": {
					"description": "Settings for virtual sun",
					"type": "object",
					"required": ["angle", "strength", "temperature"],
					"properties": {
						"angle": {
							"description": "Sun angle",
							"$ref": "#/$defs/rotation"
						},
						"strength": {
							"description": "Brightness of the sun in W/m2",
							"type": "number",
							"default": 10
						},
						"temperature": {
							"description": "Sun light color based on temperature",
							"type": "number",
							"minimum": 800,
							"maximum": 20000,
							"default": 6500
						}
					}
				}
			}
		},
		"bones": { 
			"description": "Hierarchy of connected bones",
			"type": "array",
			"items": { "$ref": "#/$defs/boneData" }
		},
		"animation": {
			"description": "Animation setup",
			"type": "object",
			"required": ["sourceMapping", "boneMapping"],
			"properties": {
				"sourceMapping": {
					"description": "Assign keys to (nested) values from all data files",
					"type": "array",
					"items": {
						"type": "object",
						"required": ["file", "values"],
						"properties": {
							"file": {
								"description": "Original file containing the desired value",
								"type": "string"
							},
							"values": {
								"description": "All values from the file",
								"type": "array",
								"items": {
									"type": "object",
									"required": ["jsonPath", "assignedKey"],
									"properties": {
										"jsonPath": {
											"description": "Array of keys in order to reach the value",
											"type": "array",
											"items": {
												"type": "string"
											}
										},
										"assignedKey": {
											"description": "Key under which this value will be stored",
											"type": "string"
										}
									}
								}
							},
							"calculatedValues": {
								"description": "Values calculated from those in the file",
								"type": "array",
								"items": {
									"type": "object",
									"required": ["key", "expression"],
									"properties": {
										"key": {
											"description": "Assigned key. Calculated values are stored in a 'calculated' object in original data.",
											"type": "string"
										},
										"expression": {
											"description": "Python lambda function with parameters data & index to calculate the value. May access previous indices e.g. for difference calculations.",
											"type": "string",
											"pattern": "^lambda data, index: "
										}
									}
								}
							}
						}
					}
				},
				"boneMapping": {
					"description": "Link animation values with bones to be animated",
					"type": "array",
					"items": {
						"type": "object",
						"required": ["valueKey", "animationTarget"],
						"properties": {
							"valueKey": {
								"description": "Key of stored value (not path in file!)",
								"type": "string"
							},
							"animationTarget": {
								"description": "What gets animated",
								"type": "object",
								"required": ["boneID", "dataPath"],
								"properties": {
									"boneID": {
										"description": "Name of animated bone",
										"type": "string"
									},
									"dataPath": {
										"description": "Path to animated bone data",
										"enum": ["rotation_quaternion", "rotation_euler", "location"]
									},
									"dataIndex": {
										"description": "Array index of data (only required if dataPath references an array)",
										"$ref": "#/$defs/indexValue"
									}
								},
								"if": {
									"properties": {
										"dataPath": {
											"enum": ["rotation_quaternion", "rotation_euler", "location"]
										}
									}
								},
								"then": {
									"required": ["dataIndex"]
								}
							}
						}
					}
				}
			}
		},
		"sensors": {
			"description": "List of sensors generating a rendered image",
			"type": "array",
			"items": {
				"type": "object",
				"required": ["id", "type", "parentBone", "fov"],
				"properties": {
					"id": {
						"description": "Unique identifier for the sensor. Also is used for the scene name.",
						"type": "string"
					},
					"type": {
						"enum": ["camera", "lidar"]
					},
					"parentBone": {
						"description": "ID of the bone by which this sensors movement is controlled",
						"type": "string"
					},
					"fov": {
						"description": "Field of View in degrees",
						"type": "number",
						"exclusiveMinimum": 0,
						"exclusiveMaximum": 180
					},
					"fisheye": {
						"description": "Apply fisheye distortion to camera output",
						"type": "object",
						"required": ["mode"],
						"properties": {
							"mode": {
								"description": "See https://docs.blender.org/api/current/bpy.types.Camera.html#bpy.types.Camera.panorama_type",
								"enum": ["FISHEYE_EQUIDISTANT", "FISHEYE_EQUISOLID"]
							},
							"lens": {
								"description": "Focal length of fisheye lens in mm",
								"type": "number",
								"minimum": 0.01,
								"maximum": 100
							}
						},
						"if": {
							"properties": {
								"mode": {
									"const": "FISHEYE_EQUISOLID"
								}
							}
						},
						"then": {
							"required": ["mode", "lens"]
						}
					}
				}
			}
		},
		"output": {
			"type": "object",
			"required": ["exportPath", "generateAlphaMaps"],
			"properties": {
				"exportPath": {
					"description": "Folder name of generated output",
					"type": "string"
				},
				"generateAlphaMaps": {
					"description": "Create additional folder with alpha map of each output?",
					"type": "boolean"
				}
			}
		}
	}
}